# yaml-language-server: $schema=../poll-config.schema.json
#
# GitHub PR Reviews Poll Configuration
#
# Polls for PRs where your review is requested and creates devcontainer
# sessions with OpenCode to review them.
#
# Prerequisites:
# - gh CLI installed and authenticated
# - Repos listed in repo_paths must exist locally
# - Custom /review command configured in OpenCode (optional)

id: github-pr-reviews
enabled: true

# Source type for tracking (used by opencode plugin)
source_type: github_pr

# Query GitHub for PRs requesting your review
# Customize the repos to match your setup
fetch_command: |
  gh pr list --repo OWNER/REPO --search "review-requested:@me" --json number,title,body,url,headRefName | jq '[.[] | . + {repo: "OWNER/REPO", repo_short: "REPO"}]'

# jq expressions to extract fields from each item
item_mapping:
  key: '"\(.repo)-review-\(.number)"'
  repo: '.repo'
  repo_short: '.repo_short'
  number: '.number'
  title: '.title'
  body: '.body // ""'
  url: '.url'
  branch: '.headRefName'

# Map repos to local paths
repo_paths:
  "OWNER/REPO": "~/path/to/repo"

# Prompt template - invokes the /review command with the PR URL
# The /review command handles fetching PR context and providing feedback
prompt:
  template: |
    /review {url}

session:
  name_template: "ocdc-{repo_short}-review-{number}"
  # Use the default 'plan' agent (read-only, safe for automated reviews)
  # Uncomment to override with a different agent:
  # agent: build
